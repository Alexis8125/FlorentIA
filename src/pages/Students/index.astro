---
import "../../styles/global.css";
import Menu from "../../components/Menu-teacher.astro";
import Progress from "../../components/Progress.astro";
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Estudiantes - FlorentIA</title>
    <link rel="icon" type="image/svg+xml" href="../../../public/logo-fondo.jpg" />
    <style>
        body {
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0px;
          box-sizing: border-box;
        }

        a{
            text-decoration:underline;
            color: #288b98;
        }
    
        h2 {
          text-align: center;
          margin-bottom: 20px;
        }
    
        table {
          width: 1000px;
          border-collapse: collapse;
          background-color: white;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          border-radius: 8px;
          overflow: hidden;
        }
    
        th, td {
          padding: 12px;
          text-align: center;
          border-bottom: 1px solid #ddd;
        }
    
        th {
          background-color: #f0f0f0;
        }
    
        img {
          width: 60px;
          height: 60px;
          object-fit: cover;
          border-radius: 50%;
        }
    
        /* Estilos responsive */
        @media screen and (max-width: 600px) {
          table, thead, tbody, th, td, tr {
            display: block;
          }
    
          thead {
            display: none;
          }
    
          tr {
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            background-color: #fff;
          }
    
          td {
            text-align: left;
            padding: 8px;
            position: relative;
          }
    
          td::before {
            content: attr(data-label);
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #333;
          }
    
          img {
            margin-top: 10px;
          }
        }
      </style>
</head>
<body>
    <div class="container">
        <div class="menu">
            <Menu></Menu>
        </div>
        <div class="information">
            <h2>Estudiantes</h2>
            <div class="list-container">
                <table>
                    <thead>
                      <tr>
                        <th>Código</th>
                        <th>Nombre</th>
                        <th>Fotografía</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td data-label="Código">Cargando...</td>
                        <td data-label="Nombre"><a href="#">Cargando...</a></td>
                        <td data-label="Fotografía"><img src="https://watermark.lovepik.com/photo/20211208/large/lovepik-junior-high-school-students-writing-homework-picture_501603943.jpg" alt="Foto de Juan Pérez"></td>
                      </tr>
                      <tr>
                        <td data-label="Código">Cargando...</td>
                        <td data-label="Nombre"> <a href="">Cargando...</a></td>
                        <td data-label="Fotografía"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2IzOezlV1Umi99uaEF4af3mlkeLD7Hzb3cQ&s" alt="Foto de María García"></td>
                      </tr>
                      <tr>
                        <td data-label="Código">Cargando...</td>
                        <td data-label="Nombre"> <a href="">Cargando...</a></td>
                        <td data-label="Fotografía"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSQVy2VlktL3aB7lqZmBp8trLVs1CU59GjU4A&s" alt="Foto de Carlos López"></td>
                      </tr>
                    </tbody>
                  </table>
            </div>
        </div>
    </div>
</body>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  
  // Tu configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCgq36r1pfgHplUt7-HSIY_qNJiEybaIJc",
    authDomain: "florentia-f47b9.firebaseapp.com",
    projectId: "florentia-f47b9",
    storageBucket: "florentia-f47b9.firebasestorage.app",
    messagingSenderId: "59886187087",
    appId: "1:59886187087:web:d274071e62e43f00b5b03a"
  };
  
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  
  // Obtener el código del docente del localStorage
  const codigoDocente = localStorage.getItem("codigoEstudiante");
  
  console.log("Código del docente desde localStorage:", codigoDocente);
  
  // Función principal
  async function cargarEstudiantes() {
    if (!codigoDocente) {
      alert("No se encontró el código del docente en el almacenamiento local.");
      return;
    }
  
    // Primero buscamos el docente para saber qué curso dicta
    const docentesRef = collection(db, "users"); // Ajusta el nombre de tu colección si es diferente
    const qDocente = query(docentesRef, where("code", "==", codigoDocente));
    const queryDocenteSnap = await getDocs(qDocente);
  
    if (queryDocenteSnap.empty) {
      alert("Docente no encontrado en la base de datos.");
      return;
    }
  
    const docenteData = queryDocenteSnap.docs[0].data();
    const cursoDocente = docenteData.course; // Aquí asumimos que el docente tiene un campo 'course' como "600" o "700" (String)
  
    console.log("Curso del docente:", cursoDocente); // Verifica el curso del docente
  
    let cursosPermitidos = [];
    if (cursoDocente === "600") { // Comparando como string
      cursosPermitidos = ["601", "602"];
    } else if (cursoDocente === "700") { // Comparando como string
      cursosPermitidos = ["701", "702"];
    } else {
      alert("El curso del docente no es válido.");
      console.log("El curso del docente no es válido.");
      return;
    }
  
    // Ahora traemos los estudiantes de esos cursos
    const estudiantesRef = collection(db, "users"); // Ajusta el nombre de tu colección si es diferente
    const qEstudiantes = query(estudiantesRef, where("course", "in", cursosPermitidos));
    const queryEstudiantesSnap = await getDocs(qEstudiantes);
  
    console.log("Estudiantes encontrados:", queryEstudiantesSnap.size); // Verifica cuántos estudiantes fueron encontrados
  
    if (queryEstudiantesSnap.empty) {
      alert("No se encontraron estudiantes para este curso.");
      return;
    }
  
    const tbody = document.querySelector("tbody");
    tbody.innerHTML = ""; // Limpiamos el tbody
  
    queryEstudiantesSnap.forEach((doc) => {
      const estudiante = doc.data();
      const tr = document.createElement("tr");
  
      tr.innerHTML = `
        <td data-label="Código">${estudiante.code}</td>
        <td data-label="Nombre"><a href="#">${estudiante.firstName + " " + estudiante.lastName}</a></td>
        <td data-label="Fotografía"><img src="${estudiante.photoUrl || 'https://via.placeholder.com/60'}" alt="Foto de ${estudiante.firstName}"></td>
      `;
      tbody.appendChild(tr);
    });
  }
  
  // Ejecutar
  cargarEstudiantes();
  </script>
  
  
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        background-color: #FFFFF0;
        /* @apply w-screen h-screen m-0 p-0 overflow-hidden; */
    }

    h2{
        @apply text-center text-[32px] font-[700] mb-[98px]
    }

    .container {
        @apply flex h-screen bg-[#FFFFF0] w-full;
    }

    .menu {
        @apply w-[300px] h-full;
    }

    .information {
        @apply w-[1500px] flex-col h-full flex items-center justify-center;
}   


    .welcome {
        @apply w-full p-[10%] flex flex-col h-[50%] items-center justify-center text-[#333];
    }

    .welcome > h1{
        font-size: 28px;
        font-weight: 400
    }

    .welcome > p{
        font-size: 34px;
        margin-top: 15px;
        font-weight: 700
        margin-bottom: -24px;
    }

    .child-image {
        @apply w-[200px] h-[200px] flex flex-col rounded-full mb-[15px];
    }

    .child-image > img {
        @apply w-full h-full rounded-full;
    }

    .advance-content {
        @apply w-full h-[50%] p-[10%] flex items-center justify-center space-x-[24px] mt-[-120px];
    }

    .progress > h2{
        @apply h-[50%]  text-[30px]  items-end flex justify-center 
    }
    .progress > span{
        @apply h-[50%] text-[20px] justify-center flex items-start
    }
</style>