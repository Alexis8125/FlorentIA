---
import "../../styles/global.css";
import Menu from "../../components/Menu-teacher.astro";
import Progress from "../../components/Progress.astro";
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="../../../public/logo-fondo.jpg" />
    <title>¡FlorentIA! - Home Student</title>
</head>
<body>
    <div class="container">
        <div class="menu">
            <Menu></Menu>
        </div>
        <div class="information">
            <div class="welcome">
                <div class="child-image">
                    <img src="../../../public/logo-fondo.jpg" alt="Logo">

                </div>
                <h1 id="welcome-message">Cargando…</h1>
                <p>
                    Tus Avances
                </p>
            </div>
            <div class="advance-content">
                <Progress percent={0}>
                    <div class="progress">
                        <h2>Personal Pronouns</h2>
                        <span>Inglés</span>
                    </div>
                </Progress>
                <Progress percent={0}>
                    <div class="progress">
                        <h2>Simple present</h2>
                        <span>Inglés</span>
                    </div>
                </Progress>
                <Progress percent={15}>
                    <div class="progress">
                        <h2>verb to be</h2>
                        <span>Inglés</span>
                    </div>
                </Progress>
            </div>
        </div>
    </div>
</body>
<!-- Al final de tu Home (.astro o .html) -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
  
    // 1) Configura tu Firebase (misma config del login)
    const firebaseConfig = {
      apiKey: "…",
      authDomain: "florentia-f47b9.firebaseapp.com",
      projectId: "florentia-f47b9",
      storageBucket: "florentia-f47b9.appspot.com",
      messagingSenderId: "59886187087",
      appId: "1:59886187087:web:d274071e62e43f00b5b03a"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
  
    // 2) Función async para cargar el nombre
    (async () => {
      const code = localStorage.getItem("codigoEstudiante");
      const welcomeEl = document.getElementById("welcome-message");
  
      if (!code) {
        welcomeEl.textContent = "¡Bienvenido a FlorentIA!";
        return;
      }
  
      try {
        const q = query(
          collection(db, "users"),
          where("code", "==", code)
        );
        const snapshot = await getDocs(q);
  
        if (!snapshot.empty) {
          const userData = snapshot.docs[0].data();
          // Asume que en Firestore guardaste un campo `name`
          const name = userData.name || `${userData.firstName} ${userData.lastName}`;
          welcomeEl.textContent = `¡Bienvenido/a, ${name}!`;
        } else {
          welcomeEl.textContent = "¡Bienvenido a FlorentIA!";
        }
      } catch (err) {
        console.error("Error al cargar nombre:", err);
        welcomeEl.textContent = "¡Bienvenido a FlorentIA!";
      }
    })();
  </script>
</html>

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        background-color: #FFFFF0;
        /* @apply w-screen h-screen m-0 p-0 overflow-hidden; */
    }

    .container {
        @apply flex h-screen bg-[#FFFFF0] w-full;
    }

    .menu {
        @apply w-[300px] h-full;
    }

    .information {
        @apply w-[1500px] flex-col h-full flex items-center justify-center;
}   


    .welcome {
        @apply w-full p-[10%] flex flex-col h-[50%] items-center justify-center text-[#333];
    }

    .welcome > h1{
        font-size: 28px;
        font-weight: 400
    }

    .welcome > p{
        font-size: 34px;
        margin-top: 15px;
        font-weight: 700
        margin-bottom: -24px;
    }

    .child-image {
        @apply w-[200px] h-[200px] flex flex-col rounded-full mb-[15px];
    }

    .child-image > img {
        @apply w-full h-full rounded-full;
    }

    .advance-content {
        @apply w-full h-[50%] p-[10%] flex items-center justify-center space-x-[24px] mt-[-120px];
    }

    .progress > h2{
        @apply h-[50%]  text-[30px]  items-end flex justify-center 
    }
    .progress > span{
        @apply h-[50%] text-[20px] justify-center flex items-start
    }
</style>