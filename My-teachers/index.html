<!DOCTYPE html><html lang="en" data-astro-cid-qi6rkanx> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="../../../public/logo-fondo.jpg"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><title>Mis profesores</title><link rel="stylesheet" href="/FlorentIA/_astro/index.BAo4qkVl.css">
<style>/*! tailwindcss v4.0.15 | MIT License | https://tailwindcss.com */.container-menu[data-astro-cid-2j44jlrm]{border-style:var(--tw-border-style);background-color:ivory;border-width:.5px;flex-direction:column;width:300px;height:100vh;display:flex}.container-logo[data-astro-cid-2j44jlrm]{justify-content:center;align-items:center;width:100%;height:180px;display:flex}.logo[data-astro-cid-2j44jlrm]{height:280px}.option[data-astro-cid-2j44jlrm]{border-style:var(--tw-border-style);border-width:.5px;justify-content:center;align-items:center;width:100%;height:85px;display:flex}@media (hover:hover){.option[data-astro-cid-2j44jlrm]:hover{cursor:pointer;background-color:beige}}.text[data-astro-cid-2j44jlrm]{font-size:24px}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}
</style>
<link rel="stylesheet" href="/FlorentIA/_astro/index.DJNvHvkb.css"></head> <body data-astro-cid-qi6rkanx> <div class="container" data-astro-cid-qi6rkanx> <div class="menu" data-astro-cid-qi6rkanx> <div class="container-menu" data-astro-cid-2j44jlrm> <div class="container-logo" data-astro-cid-2j44jlrm> <a href="/Home" class="content-home" data-astro-cid-2j44jlrm> <img src="../../public/logo.png" alt="" class="logo" data-astro-cid-2j44jlrm> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/Garden" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text text-center" data-astro-cid-2j44jlrm>
Mí Jardín
</span> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/Challenges" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text" data-astro-cid-2j44jlrm>
Mis Retos
</span> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/Achievements" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text" data-astro-cid-2j44jlrm>Mis Logros</span> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/Explore" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
Explorar
</span> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/Diary" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
Mí Diario
</span> </a> </div> <div class="option" data-astro-cid-2j44jlrm> <a href="/My-teachers" class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
Mis Profesores
</span> </a> </div> </div>  </div> <div class="information" data-astro-cid-qi6rkanx> <div class="section-title" data-astro-cid-qi6rkanx> <h2 data-astro-cid-qi6rkanx>Mis profesores</h2> </div> <div class="teacher-profile" data-astro-cid-qi6rkanx> <div class="teacher-card" data-astro-cid-qi6rkanx> <img id="fotoProfesor" class="teacher-avatar" src="" alt="Foto de la profesor@" data-astro-cid-qi6rkanx> <div class="teacher-details" data-astro-cid-qi6rkanx> <h2 id="nombreProfesor" data-astro-cid-qi6rkanx>Profe</h2> <h3 id="gradoProfesor" data-astro-cid-qi6rkanx>Inglés</h3> </div> <button class="profile-button" data-astro-cid-qi6rkanx>Ver perfil</button> </div> </div> <div class="teacher-sections" data-astro-cid-qi6rkanx> <div class="teacher-card-section" data-astro-cid-qi6rkanx> <h2 data-astro-cid-qi6rkanx>Mensajes del profesor</h2> <div id="mensajes-container" class="mensajes-container" data-astro-cid-qi6rkanx> <!-- Los mensajes se cargarán aquí dinámicamente --> </div> </div> </div> </div> </div> <div id="teacher-modal" class="modal" data-astro-cid-qi6rkanx> <div class="modal-content" data-astro-cid-qi6rkanx> <span class="close-modal" data-astro-cid-qi6rkanx>&times;</span> <div class="modal-header" data-astro-cid-qi6rkanx> <img id="modal-teacher-avatar" class="modal-avatar" src="" alt="Foto del profesor" data-astro-cid-qi6rkanx> <div class="modal-title" data-astro-cid-qi6rkanx> <h2 id="modal-teacher-name" data-astro-cid-qi6rkanx></h2> <h3 id="modal-teacher-course" data-astro-cid-qi6rkanx></h3> </div> </div> <div class="modal-body" data-astro-cid-qi6rkanx> <div class="modal-section" data-astro-cid-qi6rkanx> <h4 data-astro-cid-qi6rkanx>Descripción</h4> <p id="modal-teacher-description" data-astro-cid-qi6rkanx></p> </div> <div class="modal-section" data-astro-cid-qi6rkanx> <h4 data-astro-cid-qi6rkanx>Rol</h4> <p id="modal-teacher-role" data-astro-cid-qi6rkanx></p> </div> </div> </div> </div> <script type="module">
 import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { 
        getFirestore, 
        collection, 
        query, 
        where, 
        getDocs, 
        orderBy 
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCgq36r1pfgHplUt7-HSIY_qNJiEybaIJc",
        authDomain: "florentia-f47b9.firebaseapp.com",
        projectId: "florentia-f47b9",
        storageBucket: "florentia-f47b9.firebasestorage.app",
        messagingSenderId: "59886187087",
        appId: "1:59886187087:web:d274071e62e43f00b5b03a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function cargarMensajes() {
        const mensajesContainer = document.getElementById("mensajes-container");
        
        try {
            // Usa el mismo identificador que cargarProfesor()
            const codigoEstudiante = localStorage.getItem("codigoEstudiante");
            if (!codigoEstudiante) {
                throw new Error("No se encontró código de estudiante");
            }

            // 1. Obtener ID del estudiante (documento en Firestore)
            const studentQuery = query(
                collection(db, "users"),
                where("code", "==", codigoEstudiante)
            );
            const studentSnap = await getDocs(studentQuery);
            
            if (studentSnap.empty) {
                throw new Error("Estudiante no registrado");
            }
            
            const studentId = studentSnap.docs[0].id; // ID del documento Firestore

            // 2. Buscar mensajes
            const q = query(
                collection(db, "messages"),
                where("to", "==", studentId), // Usa el ID del documento, no el código
                orderBy("timestamp", "desc")
            );

            mensajesContainer.innerHTML = "<p class='loading'>Cargando mensajes...</p>";
            const querySnapshot = await getDocs(q);

            // 3. Mostrar resultados
            mensajesContainer.innerHTML = "";
            
            if (querySnapshot.empty) {
                mensajesContainer.innerHTML = "<p class='no-messages'>No tienes mensajes aún</p>";
                return;
            }

            // 4. Mostrar mensajes
            const nombreProfesor = document.getElementById("nombreProfesor").textContent;
            
            querySnapshot.forEach((doc) => {
                const msg = doc.data();
                const fecha = msg.timestamp?.toDate()?.toLocaleString('es-ES', {
                    day: '2-digit',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                }) || "Fecha desconocida";

                mensajesContainer.innerHTML += `
                    <div class="mensaje">
                        <div class="mensaje-cabecera">
                            <strong>${nombreProfesor}</strong>
                            <span class="fecha">${fecha}</span>
                        </div>
                        <div class="mensaje-texto">${msg.message || "Sin contenido"}</div>
                    </div>
                `;
            });

        } catch (error) {
            console.error("Error en cargarMensajes():", error);
            mensajesContainer.innerHTML = `
                <p class="error">
                    Error al cargar mensajes: ${error.message}
                </p>
            `;
        }
    }

    async function cargarProfesor() {
    const codigoEstudiante = localStorage.getItem("codigoEstudiante");
  
    if (!codigoEstudiante) {
        window.location.href = "/login";
        return;
    }
  
    const studentQuery = query(
        collection(db, "users"),
        where("code", "==", codigoEstudiante)
    );
    const studentSnap = await getDocs(studentQuery);
  
    if (studentSnap.empty) {
        alert("No se encontró el estudiante");
        return;
    }
  
    const studentData = studentSnap.docs[0].data();
    const studentCourse = studentData.course;
  
    let courseProfesor = null;
    if (studentCourse === "601" || studentCourse === "602") {
        courseProfesor = "600";
    } else if (studentCourse === "701" || studentCourse === "702") {
        courseProfesor = "700";
    }
  
    if (!courseProfesor) {
        alert("Curso no válido");
        return;
    }
  
    const profesorQuery = query(
        collection(db, "users"),
        where("course", "==", courseProfesor.toString()),
        where("role", "==", "docente")
    );
    const profesorSnap = await getDocs(profesorQuery);
  
    if (profesorSnap.empty) {
        alert("No se encontraron profesores");
        return;
    }
  
    const profesorData = profesorSnap.docs[0].data();
  
    // Llenar datos en la tarjeta principal
    document.getElementById("nombreProfesor").textContent = profesorData.firstName + " " + profesorData.lastName;
    document.getElementById("gradoProfesor").textContent = (courseProfesor == "600") ? "Sexto" : "Séptimo";
  
    const fotoProfesor = profesorData.photoUrl || "https://cdn-icons-png.freepik.com/256/14024/14024680.png?semt=ais_hybrid";
    document.getElementById("fotoProfesor").src = fotoProfesor;
    
    // Configurar el modal con los datos completos
    document.getElementById("modal-teacher-name").textContent = profesorData.firstName + " " + profesorData.lastName;
    document.getElementById("modal-teacher-course").textContent = (courseProfesor == "600") ? "Sexto" : "Séptimo";
    document.getElementById("modal-teacher-description").textContent = profesorData.description || "No hay descripción disponible";
    document.getElementById("modal-teacher-role").textContent = "Docente";
    document.getElementById("modal-teacher-avatar").src = fotoProfesor;
}

// Agrega el manejo del modal
document.addEventListener("DOMContentLoaded", () => {
    cargarProfesor();
    cargarMensajes();
    
    // Obtener elementos del modal
    const modal = document.getElementById("teacher-modal");
    const btn = document.querySelector(".profile-button");
    const span = document.querySelector(".close-modal");
    
    // Cuando se hace clic en el botón, mostrar el modal
    btn.onclick = function() {
        modal.style.display = "block";
    }
    
    // Cuando se hace clic en la X, cerrar el modal
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // Cuando se hace clic fuera del modal, cerrarlo
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
});
    
  </script> <script type="module">const s=document.getElementById("open-note"),e=document.getElementById("note-form");s.addEventListener("click",()=>{e.style.display==="none"?e.style.display="flex":e.style.display="none"});const o=document.getElementById("send-message-button");o.addEventListener("click",n=>{n.preventDefault();const t=document.getElementById("student-message").value;t.trim()!==""?(alert("Mensaje enviado: "+t),document.getElementById("student-message").value="",e.style.display="none"):alert("Por favor escribe un mensaje antes de enviar.")});</script> </body> </html>