<!DOCTYPE html>
<html lang="es" data-astro-cid-ktzmyxlz>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividades</title>
    <base href="/FlorentIA/">
    <link rel="icon" type="image/svg+xml" href="/logo-fondo.jpg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        html{
            margin: 0;
            padding: 0;
        }
        
        body{
            font-family: 'Poppins';
        }

        a{
            text-decoration: none;
            color: black;
        }
        /*! tailwindcss v4.0.15 | MIT License | https://tailwindcss.com */
        .page-container[data-astro-cid-ktzmyxlz] {
            background-color: ivory;
            width: 100%;
            height: 100vh;
            display: flex
        }

        .activities-section[data-astro-cid-ktzmyxlz] {
            background-color: ivory;
            width: 100%
        }

        .section-header[data-astro-cid-ktzmyxlz] {
            justify-content: center;
            align-items: center;
            margin-top: 40px;
            margin-bottom: 20px;
            display: flex
        }

        .main-title[data-astro-cid-ktzmyxlz] {
            color: #184d6d;
            font-size: 48px;
            font-weight: 800
        }

        .activities-column[data-astro-cid-ktzmyxlz] {
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 100%;
            display: flex
        }

        .notes-wrapper[data-astro-cid-ktzmyxlz] {
            width: 100%;
            max-height: 60vh;
            overflow-y: auto
        }

        .notes-grid[data-astro-cid-ktzmyxlz] {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            justify-items: center;
            gap: 1rem;
            display: grid
        }

        .activity-item[data-astro-cid-ktzmyxlz] {
            background-color: #a5c5aa;
            background-image: linear-gradient(90deg, #ef85354d 1px, #0000 1px), linear-gradient(#ef85354d 1px, #0000 1px);
            background-size: 20px 20px;
            border: 2px solid #ef8535;
            border-radius: 6px;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            width: 160px;
            height: 160px;
            padding: .5rem;
            text-decoration: none;
            transition: transform .2s, box-shadow .2s;
            display: flex;
            position: relative;
            box-shadow: 4px 4px 10px #0003
        }

        .activity-item[data-astro-cid-ktzmyxlz]:hover {
            transform: translateY(-4px);
            box-shadow: 6px 6px 14px #0000004d
        }

        .small-card[data-astro-cid-ktzmyxlz] {
            width: 120px;
            height: 120px
        }

        .activity-item[data-astro-cid-ktzmyxlz] h2[data-astro-cid-ktzmyxlz] {
            text-align: center;
            color: #2c2c2c;
            letter-spacing: .5px;
            margin: 0;
            font-size: 16px;
            font-weight: 500
        }

        .small-text[data-astro-cid-ktzmyxlz] {
            color: #2c2c2c;
            text-align: center;
            margin: 0;
            font-size: .75rem
        }

        .icon-container[data-astro-cid-ktzmyxlz] {
            justify-content: center;
            align-items: center;
            height: 60%;
            display: flex
        }

        .icon[data-astro-cid-ktzmyxlz] {
            stroke: #2c2c2c;
            width: 30px;
            height: 30px
        }

        .special-card[data-astro-cid-ktzmyxlz] {
            background-color: #c0f4ac
        }

        .boton-eliminar[data-astro-cid-ktzmyxlz] {
            color: #fff;
            cursor: pointer;
            background-color: #ff5900;
            border: none;
            border-radius: .5rem;
            padding: .5rem 1rem;
            transition: background-color .2s
        }

        .boton-eliminar[data-astro-cid-ktzmyxlz]:hover {
            background-color: #184d6d
        }

        .delete-wrapper[data-astro-cid-ktzmyxlz] {
            justify-content: center;
            width: 100%;
            margin-top: 1rem;
            display: flex
        }

        /*! tailwindcss v4.0.15 | MIT License | https://tailwindcss.com */
        .container-menu[data-astro-cid-2j44jlrm] {
            border-style: var(--tw-border-style);
            background-color: ivory;
            border-width: .5px;
            flex-direction: column;
            width: 300px;
            height: 100vh;
            display: flex
        }

        .container-logo[data-astro-cid-2j44jlrm] {
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 180px;
            display: flex
        }

        .logo[data-astro-cid-2j44jlrm] {
            height: 280px
        }

        .option[data-astro-cid-2j44jlrm] {
            border-style: var(--tw-border-style);
            border-width: .5px;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 85px;
            display: flex
        }

        @media (hover:hover) {
            .option[data-astro-cid-2j44jlrm]:hover {
                cursor: pointer;
                background-color: beige
            }
        }

        .text[data-astro-cid-2j44jlrm] {
            font-size: 24px
        }

        @property --tw-border-style {
            syntax: "*";
            inherits: false;
            initial-value: solid
        }
    </style>
    <link rel="stylesheet" href="/FlorentIA/_astro/index.DJNvHvkb.css">
</head>

<body data-astro-cid-ktzmyxlz>
    <div class="page-container" data-astro-cid-ktzmyxlz>
        <div class="menu" data-astro-cid-ktzmyxlz>
            <div class="container-menu" data-astro-cid-2j44jlrm>
                <div class="container-logo" data-astro-cid-2j44jlrm> <a href="/Home/" class="content-home"
                        data-astro-cid-2j44jlrm> <img src="/logo.png" alt="" class="logo"
                            data-astro-cid-2j44jlrm> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/Garden/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text text-center" data-astro-cid-2j44jlrm>
                            Mí Jardín
                        </span> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/Challenges/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text" data-astro-cid-2j44jlrm>
                            Mis Retos
                        </span> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/Achievements/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text" data-astro-cid-2j44jlrm>Mis Logros</span> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/Explore/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
                            Explorar
                        </span> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/Diary/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
                            Mí Diario
                        </span> </a> </div>
                <div class="option" data-astro-cid-2j44jlrm> <a href="/My-teachers/"
                        class="selection h-full w-full flex items-center justify-center" data-astro-cid-2j44jlrm> <span
                            class="text" style="font-family: 'Poppins', sans-serif;" data-astro-cid-2j44jlrm>
                            Mis Profesores
                        </span> </a> </div>
            </div>
        </div>
        <div class="activities-section" data-astro-cid-ktzmyxlz>
            <div class="section-header" data-astro-cid-ktzmyxlz>
                <h2 class="main-title" data-astro-cid-ktzmyxlz>Mi Diario</h2>
            </div>
            <div class="activities-column" data-astro-cid-ktzmyxlz> <!-- Botón de Agregar Nota (más pequeño) --> <a
                    href="/Diary/note" class="activity-item special-card no-underline small-card"
                    data-astro-cid-ktzmyxlz>
                    <div class="icon-container" data-astro-cid-ktzmyxlz> <svg xmlns="http://www.w3.org/2000/svg"
                            class="icon" viewBox="0 0 24 24" fill="none" stroke="#2c2c2c" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" data-astro-cid-ktzmyxlz>
                            <path d="M12 5v14M5 12h14" data-astro-cid-ktzmyxlz></path>
                        </svg> </div>
                    <h2 data-astro-cid-ktzmyxlz>Agregar Nota</h2>
                </a> <!-- Wrapping notes with scrollbar -->
                <div class="notes-wrapper" data-astro-cid-ktzmyxlz>
                    <div id="notes-container" class="notes-grid" data-astro-cid-ktzmyxlz></div>
                </div> <!-- Botón Eliminar Todas al fondo centrado -->
                <div class="delete-wrapper" data-astro-cid-ktzmyxlz> <button type="button" class="boton-eliminar"
                        onclick="clearAllNotes()" data-astro-cid-ktzmyxlz>
                        Eliminar todas las notas
                    </button> </div>
            </div>
        </div>
    </div> <!-- Firebase, Load and Delete Scripts -->
    <script type="module">
        import { db } from "FlorentIA/js/firebaseConfig.js";
        import { renderNotes } from "FlorentIA/loadNotes.js";
        import {
            collection,
            getDocs,
            deleteDoc,
            doc
        } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // Función para eliminar notas
        window.clearAllNotes = async function () {
            if (!confirm("¿Eliminar TODAS tus notas permanentemente?")) return;

            try {
                const codigo = localStorage.getItem("codigoEstudiante");
                if (!codigo) throw new Error("No se encontró el código del estudiante");

                const notasRef = collection(db, "users", codigo, "notes");
                const snapshot = await getDocs(notasRef);

                const operaciones = snapshot.docs.map(nota =>
                    deleteDoc(doc(db, "users", codigo, "notes", nota.id))
                );

                await Promise.all(operaciones);
                alert("¡Todas las notas fueron eliminadas!");
                await renderNotes();

            } catch (error) {
                console.error("Error al eliminar notas:", error);
                alert("Ocurrió un error. Verifica la consola.");
            }
        };

        // Carga inicial
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const parametros = new URLSearchParams(window.location.search);
                if (parametros.has('refresh')) {
                    localStorage.removeItem("cacheNotas");
                }

                const codigo = localStorage.getItem("codigoEstudiante");
                if (!codigo) {
                    document.getElementById("notes-container").innerHTML = `
                            <p class="error">Inicia sesión para ver tus notas</p>
                        `;
                    return;
                }

                await renderNotes();

            } catch (error) {
                console.error("Error grave al cargar:", error);
                const contenedor = document.getElementById("notes-container");
                if (contenedor) {
                    contenedor.innerHTML = `
                            <p class="error">
                                Error al cargar notas. 
                                <button onclick="location.reload()">Reintentar</button>
                            </p>
                        `;
                }
            }
        });
    </script>
    <script>
        //Rutas en GitHub Pages
        document.addEventListener('DOMContentLoaded', function () {
            if (window.location.hostname.includes('github.io')) {
                document.querySelectorAll('a[href^="/"]').forEach(link => {
                    const href = link.getAttribute('href');
                    if (!href.startsWith('/FlorentIA/')) {
                        link.setAttribute('href', '/FlorentIA' + href);
                    }
                });

                document.querySelectorAll('img[src^="/"]').forEach(img => {
                    const src = img.getAttribute('src');
                    if (!src.startsWith('/FlorentIA/')) {
                        img.setAttribute('src', '/FlorentIA' + src);
                    }
                });

                const favicon = document.querySelector('link[rel="icon"]');
                if (favicon && favicon.getAttribute('href').startsWith('/')) {
                    favicon.setAttribute('href', '/FlorentIA' + favicon.getAttribute('href'));
                }
            }
        });
    </script>
</body>

</html>